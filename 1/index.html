<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Project 1: Color Image Alignment</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f0f0f0;
        }
        .section {
            background-color: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 40px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
            text-align: center;
            border-bottom: none;
        }
        h2 {
            color: #444;
            border-bottom: 2px solid #444;
            padding-bottom: 10px;
        }
        .image-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .image-item {
            text-align: center;
            max-width: 400px;
        }
        .image-item img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            min-width: 300px; /* Ensure images don't get too small */
        }
        .code {
            background-color: #f5f5f5;
            padding: 15px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: monospace;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
        }
        th, td {
            padding: 10px;
            border: 1px solid #ddd;
            text-align: left;
        }
        th {
            background-color: #f5f5f5;
        }
    </style>
</head>
<body>
    <h1>Project 1: Colorizing the Prokudin-Gorskii Photo Collection</h1>
    
    <div class="section">
        <h2>Overview</h2>
        <p>This project involves automatically aligning and combining the three color channel images from Sergei Mikhailovich Prokudin-Gorskii's glass plate negatives to produce full-color photographs. The original images were taken through blue, green, and red filters and needed to be precisely aligned to create accurate color representations.</p>
    </div>

    <div class="section">
        <h2>My Approach</h2>
        <p>I implemented a pyramid-based alignment algorithm that uses SSD (Sum of Squared Differences) computed on Sobel gradient magnitudes for robust image alignment. Here are the key components of my implementation:</p>
        
        <h3>1. Image Processing Pipeline</h3>
        <ul>
            <li>Split the input plate into three equal parts (B, G, R channels from top to bottom)</li>
            <li>Convert to float and truncate height to a multiple of 3 to ensure proper splitting</li>
            <li>Convert to grayscale if the file loads as RGB (some JPGs do)</li>
            <li>Crop borders (≈10%) when scoring to avoid misalignment from black/white edging</li>
            <li>Compute Sobel gradient magnitude to make alignment more robust across different brightness levels</li>
        </ul>

        <h3>2. Pyramid-based Alignment</h3>
        <ul>
            <li>Build an image pyramid by downscaling by factor of 2 with anti-aliasing</li>
            <li>At coarsest level, perform exhaustive search for integer translations (Δy, Δx)</li>
            <li>Upsample the estimated shift and refine at finer levels within a small window</li>
            <li>Use SSD on Sobel magnitudes for scoring, computed only on inner cropped region</li>
            <li>Apply shifts using np.roll for efficient integer translations</li>
        </ul>

        <h3>3. Implementation Details</h3>
        <ul>
            <li>Fixed parameters: minimum size ≈400px, max window ≈15-18px, 10% border crop</li>
            <li>Align both G and R channels to B as the reference</li>
            <li>Stack final result as RGB = dstack([R_aligned, G_aligned, B])</li>
            <li>Clip values to [0,1] range and convert to uint8 for JPEG output</li>
            <li>Record and report the (dy, dx) offsets for each alignment</li>
        </ul>
    </div>

    <div class="section">
        <h2>Results</h2>
        <h3>Low Resolution Images</h3>
        <div class="image-container">
            <div class="image-item">
                <img src="./aligned/monastery_aligned.jpg" alt="Monastery">
                <p>Monastery | G->B (-3, 2) | R->B (3, 2)</p>
            </div>
            <div class="image-item">
                <img src="./aligned/cathedral_aligned.jpg" alt="Cathedral">
                <p>Cathedral | G->B (5, 2) | R->B (12, 3)</p>
            </div>
            <div class="image-item">
                <img src="./aligned/tobolsk_aligned.jpg" alt="Tobolsk">
                <p>Tobolsk | G->B (3, 3) | R->B (6, 3)</p>
            </div>
        </div>

        <h3>High Resolution Images</h3>
        <div class="image-container">
            <div class="image-item">
                <img src="./aligned/church_aligned.jpg" alt="Church">
                <p>Church | G->B (25, 4) | R->B (58, -4)</p>
            </div>
            <div class="image-item">
                <img src="./aligned/emir_aligned.jpg" alt="Emir">
                <p>Emir | G->B (49, 24) | R->B (107, 40)</p>
            </div>
            <div class="image-item">
                <img src="./aligned/harvesters_aligned.jpg" alt="Harvesters">
                <p>Harvesters | G->B (60, 17) | R->B (124, 14)</p>
            </div>
            <div class="image-item">
                <img src="./aligned/icon_aligned.jpg" alt="Icon">
                <p>Icon | G->B (42, 17) | R->B (90, 23)</p>
            </div>
            <div class="image-item">
                <img src="./aligned/italil_aligned.jpg" alt="Italil">
                <p>Italil | G->B (38, 22) | R->B (77, 36)</p>
            </div>
            <div class="image-item">
                <img src="./aligned/lastochikino_aligned.jpg" alt="Lastochikino">
                <p>Lastochikino | G->B (-3, -2) | R->B (76, -8)</p>
            </div>
            <div class="image-item">
                <img src="./aligned/lugano_aligned.jpg" alt="Lugano">
                <p>Lugano | G->B (41, -17) | R->B (92, -29)</p>
            </div>
            <div class="image-item">
                <img src="./aligned/melons_aligned.jpg" alt="Melons">
                <p>Melons | G->B (80, 10) | R->B (177, 13)</p>
            </div>
            <div class="image-item">
                <img src="./aligned/self_portrait_aligned.jpg" alt="Self Portrait">
                <p>Self Portrait | G->B (78, 29) | R->B (176, 37)</p>
            </div>
            <div class="image-item">
                <img src="./aligned/siren_aligned.jpg" alt="Siren">
                <p>Siren | G->B (49, -6) | R->B (96, -24)</p>
            </div>
            <div class="image-item">
                <img src="./aligned/three_generations_aligned.jpg" alt="Three Generations">
                <p>Three Generations | G->B (54, 12) | R->B (111, 9)</p>
            </div>
        </div>

        <h3>Additional Examples</h3>
        <div class="image-container">
            <div class="image-item">
                <img src="./aligned/service-pnp-prok-00100-00171_150px_aligned.jpg" alt="Additional Example 1">
                <p>Example 1 | G->B (1, 0) | R->B (2, 0)</p>
            </div>
            <div class="image-item">
                <img src="./aligned/service-pnp-prok-00100-00176_150px_aligned.jpg" alt="Additional Example 2">
                <p>Example 2 | G->B (1, 0) | R->B (2, 0)</p>
            </div>
        </div>
    </div>

    <div class="section">
        <h2>Technical Notes</h2>
        <p>Key aspects of the implementation:</p>
        <ul>
            <li><strong>Parameters:</strong> Used fixed parameters across all images - pyramid minimum size ≈400, maximum window ≈15-18, downscale factor of 2, and 10% border crop</li>
            <li><strong>Sobel Edge Detection:</strong> Channels can differ in exposure/spectral response; edges are more comparable across channels than raw intensities</li>
            <li><strong>Border Handling:</strong> Excluding borders during scoring prevents false matches from frame artifacts</li>
            <li><strong>Challenging Cases:</strong> Images like Emir with large displacements and strong color-channel brightness differences are handled well by the Sobel+SSD metric combined with the pyramid approach</li>
        </ul>
        <p>The implementation achieved good results across both low and high-resolution images, handling various challenges effectively through the combination of edge-based alignment and pyramid refinement.</p>
    </div>

    <div class="section">
        <h2>Challenges and Solutions</h2>
        <p>While the algorithm generally performed well, some images presented specific challenges:</p>
        <ul>
            <li><strong>High-Resolution TIFFs:</strong> Images like Melons (G->B: 80, 10 | R->B: 177, 13) and Self Portrait (G->B: 78, 29 | R->B: 176, 37) had very large displacements. The pyramid approach was crucial here, making the search manageable by starting at a coarse scale.</li>
            <li><strong>Brightness Variations:</strong> The Emir image (G->B: 49, 24 | R->B: 107, 40) was particularly challenging due to significant brightness differences between channels. Using Sobel edge detection helped overcome this by focusing on structural features rather than raw intensities.</li>
            <li><strong>Border Effects:</strong> Many images had frame artifacts or uneven borders. Our 10% border crop during scoring helped avoid misalignment from these edge effects while preserving the full image in the final output.</li>
        </ul>
        <p>No images completely failed to align, though some high-resolution images required larger search windows to handle their substantial displacements.</p>
    </div>

</body>
</html>
